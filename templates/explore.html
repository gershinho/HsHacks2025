<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recipe from {{ country }}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    .recipe-title {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .note-card {
      background-color: #ffffff;
      border: 1px solid #ddd;
      padding: 20px;
      margin: 0 auto 20px auto;
      width: 80%;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .content-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .ingredients {
      flex: 1;
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    details {
      background-color: #eef;
      border: 1px solid #99c;
      padding: 10px;
      width: 80%;
      margin: 20px auto;
      border-radius: 8px;
    }
    details summary {
      font-weight: bold;
      cursor: pointer;
    }
    .instruction-controls {
      margin-top: 10px;
      text-align: center;
    }
    .instruction-controls button {
      padding: 5px 10px;
      margin: 0 10px;
      font-size: 14px;
      cursor: pointer;
    }
    a {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: #0066cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1 class="recipe-title">Recipe from {{ country }}</h1>
  
  {% if recipe %}
    <h2 class="recipe-title">{{ recipe.title }}</h2>
    
    <!-- Note Card for Summary -->
    <div class="note-card">
      <h3>Summary</h3>
      <p>{{ recipe.summary|safe }}</p>
    </div>
    
    <!-- Two-column layout: Ingredients -->
    <div class="content-container">
      <div class="ingredients">
        <h3>Ingredients:</h3>
        <ul> 
          {% for item in recipe.ingredients %}
            <li>{{ item }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    
    <!-- Dropdown for Step-by-Step Instructions -->
    <details id="instructionDetails">
      <summary>Show Instructions</summary>
      <div id="instructionContainer">
        <p id="instructionStep"></p>
        <div class="instruction-controls">
          <button id="prevBtn">← Prev</button>
          <button id="nextBtn">Next →</button>
        </div>
      </div>
    </details>
  
  {% else %}
    <p>Sorry, no suitable recipe was found for {{ country }}.</p>
  {% endif %}
  
  <a href="/">Back to country selection</a>
  
  <!-- JavaScript for Step-by-Step Instructions -->
  <script>
    // Retrieve instructions passed from Flask.
    const instructionsHTML = {{ recipe.instructions | tojson }};
    
    let steps = [];
    
    // Create a temporary container to parse HTML.
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = instructionsHTML;
    // Check for list items first.
    const listItems = tempDiv.querySelectorAll('li');
    if (listItems.length > 0) {
      steps = Array.from(listItems).map(item => item.textContent.trim());
    } else if (instructionsHTML.match(/\d+\.\s/)) {
      // Otherwise, look for numbered steps if available.
      steps = instructionsHTML.split(/(?=\d+\.\s)/);
      steps = steps.map(s => s.trim()).filter(s => s.length > 0);
    } else if (instructionsHTML) {
      // Fallback: split by period.
      steps = instructionsHTML.split('.').map(s => s.trim()).filter(s => s.length > 0);
    }
    
    let currentStep = 0;
    
    function showStep(index) {
      const stepEl = document.getElementById("instructionStep");
      if (index >= 0 && index < steps.length) {
        // Prepend a step number.
        stepEl.innerText = "Step " + (index + 1) + ": " + steps[index];
        currentStep = index;
      }
      document.getElementById("prevBtn").disabled = (currentStep === 0);
      document.getElementById("nextBtn").disabled = (currentStep === steps.length - 1);
    }
    
    document.getElementById("prevBtn").addEventListener("click", () => {
      if (currentStep > 0) {
        showStep(currentStep - 1);
      }
    });
    
    document.getElementById("nextBtn").addEventListener("click", () => {
      if (currentStep < steps.length - 1) {
        showStep(currentStep + 1);
      }
    });
    
    // When dropdown is opened, show the first instruction.
    document.getElementById("instructionDetails").addEventListener("toggle", function() {
      if (this.open && steps.length > 0) {
        showStep(0);
      }
    });
  </script>
</body>
</html>
